
==================================================
FILE: debug-project.js
==================================================
import fs from 'fs';
import path from 'path';

// IGNORE these folders/files so the output isn't too huge
const IGNORE = ['.git', 'node_modules', 'dist', 'build', 'package-lock.json', '.env', 'assets'];
const EXTENSIONS = ['.js', '.jsx', '.css', '.json', '.html'];

function getAllFiles(dirPath, arrayOfFiles) {
  const files = fs.readdirSync(dirPath);
  arrayOfFiles = arrayOfFiles || [];

  files.forEach(function(file) {
    if (IGNORE.includes(file)) return;
    
    const fullPath = path.join(dirPath, file);
    
    if (fs.statSync(fullPath).isDirectory()) {
      arrayOfFiles = getAllFiles(fullPath, arrayOfFiles);
    } else {
      // Only include specific code extensions
      if (EXTENSIONS.includes(path.extname(file))) {
        arrayOfFiles.push(fullPath);
      }
    }
  });

  return arrayOfFiles;
}

// Run the dumper
console.log("--- START OF PROJECT DUMP ---");

['frontend', 'backend'].forEach(folder => {
    try {
        const folderPath = path.join(process.cwd(), folder);
        if (fs.existsSync(folderPath)) {
            const files = getAllFiles(folderPath);
            files.forEach(filePath => {
                const relativePath = path.relative(process.cwd(), filePath);
                const content = fs.readFileSync(filePath, 'utf8');
                console.log(`\n\n================================================================`);
                console.log(`FILE: ${relativePath}`);
                console.log(`================================================================`);
                console.log(content);
            });
        }
    } catch (e) {
        console.error(`Could not read ${folder}:`, e.message);
    }
});

console.log("\n--- END OF PROJECT DUMP ---");

==================================================
FILE: backend\db.js
==================================================
import mongoose from "mongoose";

const connectDB = async () => {
  try {
    await mongoose.connect(process.env.MONGO_URI);
    console.log("‚úÖ MongoDB Connected");
  } catch (err) {
    console.error("‚ùå MongoDB Connection Error:", err);
    process.exit(1); // Stop server if DB fails
  }
};

export default connectDB;

==================================================
FILE: backend\index.js
==================================================
import express from "express";
import cors from "cors";
import dotenv from "dotenv";
import connectDB from "./db.js";
import aiRoutes from "./routes/ai.js";
import codeRoutes from "./routes/code.js";
import shareRoutes from "./routes/share.js";
import authRoutes from "./routes/auth.js";
// 1. IMPORT SOCKET LIBRARIES
import http from "http"; 
import { Server } from "socket.io"; 

dotenv.config();
connectDB();

const app = express();
app.use(express.json());

// Allow requests from your Vercel frontend
app.use(cors({
  origin: "*", // Allow all origins for easier development
  methods: ["GET", "POST"],
  credentials: true
}));

// 2. CREATE HTTP SERVER & SOCKET SERVER
const server = http.createServer(app); // Wrap Express app
const io = new Server(server, {
  cors: {
    origin: "*", // Allow all connections
    methods: ["GET", "POST"]
  }
});
// TRACK USERS: Map<socketId, username>
const userMap = new Map();

io.on("connection", (socket) => {
  console.log("User connected:", socket.id);

  // 1. JOIN ROOM with USERNAME
  socket.on("join_room", ({ roomId, username }) => {
    socket.join(roomId);
    socket.roomId = roomId; // <--- STORE ROOM ID
      socket.username = username; // <--- STORE USERNAME
    // Save username
    userMap.set(socket.id, username);
    console.log(`User ${username} (${socket.id}) joined room: ${roomId}`);

    // Get all users in this room
    const clients = Array.from(io.sockets.adapter.rooms.get(roomId) || []);
    const users = clients.map(clientId => userMap.get(clientId)).filter(name => name);

    // Tell everyone (including sender) who is in the room
    io.to(roomId).emit("room_users", users);
  });

  // 2. CODE CHANGE (Existing)
  socket.on("code_change", ({ roomId, code }) => {
    socket.to(roomId).emit("receive_code", code);
  });

  // 3. TYPING INDICATOR (New)
  socket.on("typing", ({ roomId, username }) => {
    socket.to(roomId).emit("user_typing", username);
  });
  socket.on("cursor_move", ({ roomId, username, position }) => {
    // position = { fileType: "cpp", lineNumber: 10, column: 5 }
    // Broadcast to everyone else in the room
    socket.to(roomId).emit("cursor_update", { username, position });
  });
  socket.on("sync_run_trigger", ({ roomId, username }) => {
    // Tell everyone else execution has started
    socket.to(roomId).emit("sync_run_start", { username });
  });

  // 6. SYNC RUN: COMPLETE
  socket.on("sync_run_result", ({ roomId, logs }) => {
    // Send the execution output to everyone else
    socket.to(roomId).emit("sync_run_complete", { logs });
  });
  // 4. DISCONNECT
socket.on("disconnect", () => {
    console.log("User disconnected:", socket.id);

    // 1. Notify others that user left (to remove their cursor)
    if (socket.roomId && socket.username) {
        socket.to(socket.roomId).emit("user_left", { username: socket.username });
    }

    // 2. Clean up memory
    userMap.delete(socket.id);
  });
});

// Routes
app.use("/api/auth", authRoutes);
app.use("/api/ai", aiRoutes);
app.use("/api/code", codeRoutes);
app.use("/api/share", shareRoutes);

app.get("/", (req, res) => {
  res.send("API is running...");
});

// 4. IMPORTANT: LISTEN WITH 'server', NOT 'app'
const PORT = process.env.PORT || 5000;
server.listen(PORT, () => {
  console.log(`Server running on port ${PORT}`);
});

==================================================
FILE: backend\package.json
==================================================
{
  "name": "backend",
  "version": "1.0.0",
  "description": "",
  "main": "index.js",
  "scripts": {
    "test": "echo \"Error: no test specified\" && exit 1"
  },
  "keywords": [],
  "author": "",
  "license": "ISC",
  "dependencies": {
    "@google/generative-ai": "^0.24.1",
    "bcryptjs": "^3.0.3",
    "cors": "^2.8.5",
    "dotenv": "^17.2.3",
    "express": "^5.2.1",
    "jsonwebtoken": "^9.0.3",
    "mongoose": "^9.0.1",
    "socket.io": "^4.8.1"
  }
}


==================================================
FILE: backend\test-gemini.js
==================================================
import { GoogleGenerativeAI } from "@google/generative-ai";
import dotenv from "dotenv";
dotenv.config();

// Simple script to check what models are available to your Key
async function checkModels() {
  if (!process.env.GEMINI_API_KEY) {
    console.log("‚ùå No API Key found in .env");
    return;
  }

  console.log("Checking available models...");
  // We use a raw fetch here to bypass any SDK version weirdness
  const url = `https://generativelanguage.googleapis.com/v1beta/models?key=${process.env.GEMINI_API_KEY}`;
  
  try {
    const response = await fetch(url);
    const data = await response.json();

    if (data.error) {
        console.error("‚ùå API Error:", data.error.message);
    } else {
        console.log("‚úÖ Connection Successful! Available models:");
        // Filter for just the names to make it readable
        const models = data.models.map(m => m.name.replace("models/", ""));
        console.log(models.join(", "));
        
        if (models.includes("gemini-1.5-flash")) {
            console.log("\nSUCCESS: gemini-1.5-flash is available for your key.");
        } else {
            console.log("\n‚ö†Ô∏è ISSUE: gemini-1.5-flash is NOT in your list.");
        }
    }
  } catch (error) {
    console.error("‚ùå Network Error:", error);
  }
}

checkModels();

==================================================
FILE: backend\models\SharedCode.js
==================================================
import mongoose from "mongoose";

const SharedCodeSchema = new mongoose.Schema({
  language: { type: String, required: true }, // "web", "cpp", "java", "python"
  
  // 'Mixed' type allows us to store either a String (C++) or an Object (HTML/CSS/JS)
  code: { type: mongoose.Schema.Types.Mixed, required: true }, 
  
  stdin: { type: String, default: "" }, // For C++ inputs
  createdAt: { type: Date, default: Date.now }
});

export default mongoose.model("SharedCode", SharedCodeSchema);

==================================================
FILE: backend\models\User.js
==================================================
import mongoose from "mongoose";

const UserSchema = new mongoose.Schema({
  username: { type: String, required: true, unique: true },
  email:    { type: String, required: true, unique: true },
  password: { type: String, required: true }, // Will be hashed (encrypted)
  createdAt:{ type: Date, default: Date.now }
});

export default mongoose.model("User", UserSchema);

==================================================
FILE: backend\routes\ai.js
==================================================
import express from "express";
import { GoogleGenerativeAI } from "@google/generative-ai";

const router = express.Router();

router.post("/assist", async (req, res) => {
  try {
    const { prompt, code } = req.body;

    if (!prompt) {
      return res.status(400).json({ error: "Prompt is required" });
    }

    if (!process.env.GEMINI_API_KEY) {
      console.error("Error: GEMINI_API_KEY is missing in .env");
      return res.status(500).json({ error: "Server API Key configuration missing" });
    }

    const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY);

    // FIX 1: Use the correct model name
    const model = genAI.getGenerativeModel({
      model: "gemini-flash-latest", 
    });
    const fullPrompt = `
You are an AI assistant inside a web code editor.
HTML: ${code?.html || ""}
CSS: ${code?.css || ""}
JS: ${code?.js || ""}
User request: ${prompt}
    `;

    const result = await model.generateContent(fullPrompt);
    
    // FIX 2: Correct way to extract text in the latest SDK
    const response = await result.response;
    const text = response.text();

    res.json({ result: text });

  } catch (err) {
    // This logs the ACTUAL error to your VS Code terminal
    console.error("GEMINI API ERROR DETAILS:", err);
    
    // Send a more descriptive error to the frontend if possible
    res.status(500).json({ 
        error: "AI Generation failed", 
        details: err.message || "Unknown error" 
    });
  }
});

export default router;

==================================================
FILE: backend\routes\auth.js
==================================================
import express from "express";
import bcrypt from "bcryptjs";
import jwt from "jsonwebtoken";
import User from "../models/User.js";

const router = express.Router();

// 1. REGISTER USER
router.post("/register", async (req, res) => {
  try {
    const { username, email, password } = req.body;

    // Check if user already exists
    const existingUser = await User.findOne({ email });
    if (existingUser) return res.status(400).json({ error: "User already exists" });

    // Encrypt the password
    const salt = await bcrypt.genSalt(10);
    const hashedPassword = await bcrypt.hash(password, salt);

    // Save to Database
    const newUser = new User({ username, email, password: hashedPassword });
    await newUser.save();

    res.status(201).json({ message: "User registered successfully" });
  } catch (err) {
    res.status(500).json({ error: "Server error during registration" });
  }
});

// 2. LOGIN USER
router.post("/login", async (req, res) => {
  try {
    const { email, password } = req.body;

    // Find User
    const user = await User.findOne({ email });
    if (!user) return res.status(400).json({ error: "Invalid credentials" });

    // Check Password
    const isMatch = await bcrypt.compare(password, user.password);
    if (!isMatch) return res.status(400).json({ error: "Invalid credentials" });

    // Create Token (The "Badge")
    // Note: In production, keep "SECRET_KEY" in your .env file
    const token = jwt.sign(
      { id: user._id, username: user.username }, 
      process.env.JWT_SECRET || "default_secret_key", 
      { expiresIn: "1h" }
    );

    res.json({ 
        token, 
        user: { id: user._id, username: user.username, email: user.email } 
    });
  } catch (err) {
    res.status(500).json({ error: "Server error during login" });
  }
});

export default router;

==================================================
FILE: backend\routes\code.js
==================================================
import express from "express";

const router = express.Router();

// Map your frontend language names to Piston API versions
const RUNTIMES = {
  cpp: { language: "c++", version: "10.2.0" },
  java: { language: "java", version: "15.0.2" },
  python: { language: "python", version: "3.10.0" },
};

router.post("/execute", async (req, res) => {
  // 1. Accept 'stdin' from the request
  const { language, code, stdin } = req.body;

  if (!RUNTIMES[language]) {
    return res.status(400).json({ error: "Unsupported Language" });
  }

  const runtime = RUNTIMES[language];

  try {
    const response = await fetch("https://emkc.org/api/v2/piston/execute", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({
        language: runtime.language,
        version: runtime.version,
        files: [{ content: code }],
        stdin: stdin || "", // 2. Pass the input to Piston (or empty string)
      }),
    });

    const data = await response.json();
    res.json(data);
    
  } catch (error) {
    console.error("Execution Error:", error);
    res.status(500).json({ error: "Failed to execute code" });
  }
});

export default router;

==================================================
FILE: backend\routes\share.js
==================================================
import express from "express";
import SharedCode from "../models/SharedCode.js";

const router = express.Router();

// 1. SAVE CODE (POST /api/share)
router.post("/generate", async (req, res) => {
  try {
    const { language, code, stdin } = req.body;
    
    // Create new entry in DB
    const newShare = await SharedCode.create({ language, code, stdin });
    
    // Return the unique ID (_id)
    res.json({ id: newShare._id, message: "Code saved successfully" });
  } catch (error) {
    res.status(500).json({ error: "Failed to save code" });
  }
});

// 2. GET CODE (GET /api/share/:id)
router.get("/:id", async (req, res) => {
  try {
    const sharedData = await SharedCode.findById(req.params.id);
    
    if (!sharedData) {
      return res.status(404).json({ error: "Code not found" });
    }
    
    res.json(sharedData);
  } catch (error) {
    res.status(500).json({ error: "Invalid ID" });
  }
});

export default router;

==================================================
FILE: frontend\eslint.config.js
==================================================
import js from '@eslint/js'
import globals from 'globals'
import reactHooks from 'eslint-plugin-react-hooks'
import reactRefresh from 'eslint-plugin-react-refresh'
import { defineConfig, globalIgnores } from 'eslint/config'

export default defineConfig([
  globalIgnores(['dist']),
  {
    files: ['**/*.{js,jsx}'],
    extends: [
      js.configs.recommended,
      reactHooks.configs.flat.recommended,
      reactRefresh.configs.vite,
    ],
    languageOptions: {
      ecmaVersion: 2020,
      globals: globals.browser,
      parserOptions: {
        ecmaVersion: 'latest',
        ecmaFeatures: { jsx: true },
        sourceType: 'module',
      },
    },
    rules: {
      'no-unused-vars': ['error', { varsIgnorePattern: '^[A-Z_]' }],
    },
  },
])


==================================================
FILE: frontend\index.html
==================================================
<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/vite.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>frontend</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>


==================================================
FILE: frontend\package.json
==================================================
{
  "name": "frontend",
  "private": true,
  "version": "0.0.0",
  "type": "module",
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "lint": "eslint .",
    "preview": "vite preview"
  },
  "dependencies": {
    "@monaco-editor/react": "^4.7.0",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-markdown": "^10.1.0",
    "react-router-dom": "^7.10.1",
    "react-syntax-highlighter": "^16.1.0",
    "socket.io-client": "^4.8.1"
  },
  "devDependencies": {
    "@eslint/js": "^9.39.1",
    "@types/react": "^19.2.5",
    "@types/react-dom": "^19.2.3",
    "@vitejs/plugin-react": "^5.1.1",
    "eslint": "^9.39.1",
    "eslint-plugin-react-hooks": "^7.0.1",
    "eslint-plugin-react-refresh": "^0.4.24",
    "globals": "^16.5.0",
    "vite": "^7.2.4"
  }
}


==================================================
FILE: frontend\vercel.json
==================================================
{
  "rewrites": [
    {
      "source": "/(.*)",
      "destination": "/index.html"
    }
  ]
}

==================================================
FILE: frontend\vite.config.js
==================================================
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

// https://vite.dev/config/
export default defineConfig({
  plugins: [react()],
})


==================================================
FILE: frontend\src\App.css
==================================================
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

html,
body,
#root {
  width: 100%;
  height: 100%;
  background: #111;
}


==================================================
FILE: frontend\src\App.jsx
==================================================
import { useState, useEffect } from "react";
import Editors from "./components/Editors";
import Preview from "./components/Preview";
import AIButton from "./components/AIButton";
import AIPanel from "./components/AIPanel";
import ConsolePanel from "./components/ConsolePanel";
import ShareModal from "./components/ShareModal";
import AuthModal from "./components/AuthModal";
import { useParams, useNavigate } from "react-router-dom"; 
import { API_URL } from "./config"; 
import io from "socket.io-client";
import { useAuth } from "./context/AuthContext";

const socket = io(API_URL);

export default function App() {
  const { id } = useParams();
  const navigate = useNavigate(); 
  const { user, logout } = useAuth();

  // --- STATE ---
  const [language, setLanguage] = useState("web"); 
  const [html, setHtml] = useState("<h2>Hello User</h2>");
  const [css, setCss] = useState("body { text-align: center; font-family: sans-serif; }");
  const [js, setJs] = useState("console.log('Hello from JS!');");
  const [cppCode, setCppCode] = useState(`#include <iostream>\nusing namespace std;\n\nint main() {\n    cout << "Hello from C++!" << endl;\n    return 0;\n}`);
  const [javaCode, setJavaCode] = useState(`public class Main {\n    public static void main(String[] args) {\n        System.out.println("Hello from Java!");\n    }\n}`);
  const [pythonCode, setPythonCode] = useState(`print("Hello from Python!")`);

  const [activeCode, setActiveCode] = useState({ html, css, js });
  const [isAutoRun, setIsAutoRun] = useState(true);
  const [input, setInput] = useState(""); 
  const [aiOpen, setAiOpen] = useState(false);
  const [logs, setLogs] = useState([]);
  const [consoleOpen, setConsoleOpen] = useState(true);
  
  const [shareModalOpen, setShareModalOpen] = useState(false);
  const [authModalOpen, setAuthModalOpen] = useState(false);
  const [shareUrl, setShareUrl] = useState("");
  const [isRunning, setIsRunning] = useState(false);
  const [isCreatingRoom, setIsCreatingRoom] = useState(false); 

  const [activeUsers, setActiveUsers] = useState([]); 
  const [typingUser, setTypingUser] = useState("");   
  const [remoteCursors, setRemoteCursors] = useState({}); 

  // --- SOCKETS ---
  useEffect(() => {
    if (id && user) { 
        socket.emit("join_room", { roomId: id, username: user.username });
        
        // RECEIVER LOGIC (FIXED)
        const handleReceiveCode = (payload) => {
             // Debug log to verify data arrival
             console.log("üì® Received update:", payload);

             // payload = { language: "cpp", code: "..." }
             if (payload.language === "web") {
                 const data = payload.code;
                 if (data.html !== undefined) setHtml(data.html);
                 if (data.css !== undefined) setCss(data.css);
                 if (data.js !== undefined) setJs(data.js);
             } else {
                 // FIX: specific checks based on INCOMING language, not local state
                 if (payload.language === "cpp") setCppCode(payload.code);
                 if (payload.language === "java") setJavaCode(payload.code);
                 if (payload.language === "python") setPythonCode(payload.code);
             }
        };

        const handleRoomUsers = (users) => setActiveUsers(users);
        
        const handleTyping = (username) => {
            setTypingUser(`${username} is typing...`);
            setTimeout(() => setTypingUser(""), 2000);
        };

        const handleCursorUpdate = ({ username, position }) => {
            if (username !== user.username) {
                setRemoteCursors(prev => ({ ...prev, [username]: { position } }));
            }
        };
        const handleSyncRunStart = ({ username }) => { 
            setConsoleOpen(true); setIsRunning(true); setLogs([{ type: "info", message: `üöÄ ${username} started execution...` }]); 
        };
        const handleSyncRunComplete = ({ logs }) => { 
            setIsRunning(false); setLogs(prev => [...prev, ...logs]); 
        };
        const handleUserLeft = ({ username }) => {
            setRemoteCursors(prev => { const n = {...prev}; delete n[username]; return n; });
            setActiveUsers(prev => prev.filter(u => u !== username));
        };

        // Attach Listeners
        socket.on("receive_code", handleReceiveCode);
        socket.on("room_users", handleRoomUsers);
        socket.on("user_typing", handleTyping);
        socket.on("cursor_update", handleCursorUpdate);
        socket.on("sync_run_start", handleSyncRunStart);
        socket.on("sync_run_complete", handleSyncRunComplete);
        socket.on("user_left", handleUserLeft);

        return () => {
            socket.off("receive_code", handleReceiveCode);
            socket.off("room_users", handleRoomUsers);
            socket.off("user_typing", handleTyping);
            socket.off("cursor_update", handleCursorUpdate);
            socket.off("sync_run_start", handleSyncRunStart);
            socket.off("sync_run_complete", handleSyncRunComplete);
            socket.off("user_left", handleUserLeft);
        };
    }
  }, [id, user]); // Dependency array is SAFE (Removed 'language')

  const handleCodeChange = (type, value) => {
      // 1. Update Local State as usual
      if (type === "html") setHtml(value);
      if (type === "css") setCss(value);
      if (type === "js") setJs(value);
      if (type === "cpp") setCppCode(value);
      if (type === "java") setJavaCode(value);
      if (type === "python") setPythonCode(value);

      // 2. Broadcast to Room
      if (id && user) {
          // FIX: Send an object with language AND code
          let payload = {
              language: language, 
              code: value
          };

          // Special structure for Web
          if (language === "web") {
              payload.code = { html, css, js, [type]: value };
          }

          socket.emit("code_change", { roomId: id, code: payload });
          socket.emit("typing", { roomId: id, username: user.username });
      }
  };

  // --- LOAD SAVED CODE ---
  useEffect(() => {
    if (id) {
      fetch(`${API_URL}/api/share/${id}`)
        .then(res => res.json())
        .then(data => {
          if (data.error) return alert("Room not found!");
          setLanguage(data.language);
          if (data.language === "web") {
            setHtml(data.code.html); setCss(data.code.css); setJs(data.code.js); setActiveCode(data.code); 
          } else if (data.language === "cpp") {
            setCppCode(data.code); setInput(data.stdin || "");
          } else if (data.language === "java") {
            setJavaCode(data.code); setInput(data.stdin || "");
          } else if (data.language === "python") {
            setPythonCode(data.code); setInput(data.stdin || "");
          }
        })
        .catch(err => console.error(err));
    }
  }, [id]); 

  // --- HANDLERS ---
  
  // NEW: CREATE ROOM FUNCTION
  async function handleCreateRoom() {
    if (!user) {
        setAuthModalOpen(true);
        return;
    }
    
    setIsCreatingRoom(true);
    
    const bodyData = language === "web" ? { language: "web", code: { html, css, js } } 
        : { language, code: language === "cpp" ? cppCode : (language === "java" ? javaCode : pythonCode), stdin: input };

    try {
        const res = await fetch(`${API_URL}/api/share/generate`, {
            method: "POST", headers: { "Content-Type": "application/json" }, body: JSON.stringify(bodyData),
        });
        const data = await res.json();
        
        if (data.id) {
            // Redirect to the Room URL
            window.location.href = `/share/${data.id}`;
        }
    } catch (e) { alert("Error creating room"); }
    finally { setIsCreatingRoom(false); }
  }

  async function handleRun() {
    if (!user) { setAuthModalOpen(true); return; }

    // Case 1: Web (Just sync the active code state)
    if (language === "web") { 
        setActiveCode({ html, css, js }); 
        return; 
    } 

    // Case 2: C++/Java/Python
    setConsoleOpen(true);
    setIsRunning(true);
    setLogs([{ type: "info", message: "Compiling..." }]);

    //1. Tell others we are starting
    if (id) {
        socket.emit("sync_run_trigger", { roomId: id, username: user.username });
    }

    try {
        const res = await fetch(`${API_URL}/api/code/execute`, {
            method: "POST", 
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ 
                language, 
                code: language === "cpp" ? cppCode : (language === "java" ? javaCode : pythonCode), 
                stdin: input 
            }),
        });
        const data = await res.json();
        
        // Prepare logs
        const newLogs = [
             { type: data.run?.code === 0 ? "log" : "error", message: data.run?.output || "Execution finished." }
        ];

        setLogs(prev => [...prev, ...newLogs]);

        //2. Send the result to others
        if (id) {
            socket.emit("sync_run_result", { roomId: id, logs: newLogs });
        }

    } catch (err) { 
        const errorLog = [{ type: "error", message: "Server Error." }];
        setLogs(prev => [...prev, ...errorLog]);
        
        // Broadcast error too
        if (id) socket.emit("sync_run_result", { roomId: id, logs: errorLog });
    }
    finally { 
        setIsRunning(false); 
    }
  }

  // Helper to Copy Link (If already in a room)
  function handleCopyLink() {
      const url = window.location.href;
      setShareUrl(url);
      setShareModalOpen(true);
  }

  return (
    <>
      <div style={{ height: "100vh", display: "flex", flexDirection: "column", overflow: "hidden", background: "#1e1e1e" }}>
        
        {/* HEADER */}
        <div style={{ height: "50px", background: "#111", display: "flex", alignItems: "center", justifyContent: "space-between", padding: "0 16px", borderBottom: "1px solid #333" }}>
            <div style={{ display: "flex", alignItems: "center", gap: "16px" }}>
                <span style={{ fontWeight: "bold", color: "#fff", fontSize: "18px" }}>üöÄ CodePlay</span>
                
                {/* NAVBAR FIX: Fixed Select Element */}
                <select 
                    value={language} 
                    onChange={(e) => { setLanguage(e.target.value); setLogs([]); }}
                    style={{ background: "#222", color: "white", border: "1px solid #444", padding: "6px 12px", borderRadius: "4px", outline: "none", cursor: "pointer" }}
                >
                    <option value="web">üåê HTML/JS</option>
                    <option value="cpp">‚öôÔ∏è C++</option>
                    <option value="java">‚òï Java</option>
                    <option value="python">üêç Python</option>
                </select>

                {/* USER AVATARS */}
                {activeUsers.length > 0 && (
                  <div style={{ display: "flex", gap: "-5px", marginLeft: "10px" }}>
                    {activeUsers.map((name, i) => (
                      <div key={i} title={name} style={{ width: "24px", height: "24px", borderRadius: "50%", background: `hsl(${i * 60}, 70%, 50%)`, color: "#fff", fontSize: "10px", fontWeight: "bold", display: "flex", alignItems: "center", justifyContent: "center", border: "2px solid #111" }}>
                        {name[0].toUpperCase()}
                      </div>
                    ))}
                  </div>
                )}
                {typingUser && <span style={{ color: "#aaa", fontSize: "12px", fontStyle: "italic" }}>{typingUser}</span>}
            </div>

            <div style={{ display: "flex", alignItems: "center", gap: "16px" }}>
                {user ? (
                   <div style={{ display: "flex", alignItems: "center", gap: "10px" }}>
                      <span style={{ color: "#4caf50", fontWeight: "bold", fontSize: "14px" }}>‚óè {user.username}</span>
                      <button onClick={logout} style={{ background: "none", border: "1px solid #444", color: "#888", padding: "4px 10px", borderRadius: "4px", cursor: "pointer", fontSize: "12px" }}>Logout</button>
                   </div>
                ) : (
                   <button onClick={() => setAuthModalOpen(true)} style={{ background: "#007acc", color: "white", border: "none", padding: "6px 12px", borderRadius: "4px", cursor: "pointer", fontWeight: "bold", fontSize: "13px" }}>üë§ Login</button>
                )}

                {/* NEW BUTTONS: Create Room vs Invite */}
                {!id ? (
                     <button 
                        onClick={handleCreateRoom}
                        disabled={isCreatingRoom}
                        style={{ background: "#8e44ad", color: "white", border: "1px solid #9b59b6", borderRadius: "6px", padding: "6px 16px", fontSize: "14px", fontWeight: "600", cursor: "pointer", display: "flex", alignItems: "center", gap: "6px" }}
                    >
                        {isCreatingRoom ? "Creating..." : "‚ûï Create Room"}
                    </button>
                ) : (
                    <button 
                        onClick={handleCopyLink}
                        style={{ background: "#444", color: "white", border: "1px solid #666", borderRadius: "6px", padding: "6px 16px", fontSize: "14px", fontWeight: "600", cursor: "pointer", display: "flex", alignItems: "center", gap: "6px" }}
                    >
                        üîó Invite
                    </button>
                )}

                <button onClick={handleRun} disabled={isRunning} style={{ background: "#238636", color: "white", border: "1px solid rgba(240,246,252,0.1)", borderRadius: "6px", padding: "6px 16px", fontSize: "14px", fontWeight: "600", cursor: "pointer", opacity: isRunning ? 0.7 : 1 }}>
                    {isRunning ? "‚è≥..." : "‚ñ∂ Run"}
                </button>
            </div>
        </div>

        {/* EDITORS */}
        <div style={{ height: language === "web" ? "calc(50% - 25px)" : "calc(100% - 250px)", width: "100%", borderBottom: "4px solid #1e1e1e" }}>
          <Editors
            language={language}
            html={html} setHtml={(val) => handleCodeChange("html", val)}
            css={css} setCss={(val) => handleCodeChange("css", val)}
            js={js} setJs={(val) => handleCodeChange("js", val)}
            cppCode={cppCode} setCppCode={(val) => handleCodeChange("cpp", val)}
            javaCode={javaCode} setJavaCode={(val) => handleCodeChange("java", val)}
            pythonCode={pythonCode} setPythonCode={(val) => handleCodeChange("python", val)}
            socket={socket}
            roomId={id}
            username={user?.username} 
            remoteCursors={remoteCursors}
          />
        </div>

       {/* OUTPUT */}
        <div style={{ flex: 1, display: "flex", flexDirection: "column", position: "relative", overflow: "hidden" }}>
          {language === "web" ? (
             <>
               <div style={{ flex: 1, overflow: "hidden" }}><Preview html={activeCode.html} css={activeCode.css} js={activeCode.js} /></div>
               <ConsolePanel isOpen={consoleOpen} onClose={() => setConsoleOpen(false)} logs={logs} onClear={() => setLogs([])} />
             </>
          ) : (
             <div style={{ display: "flex", height: "100%", width: "100%" }}>
                <div style={{ flex: 1, display: "flex", flexDirection: "column", borderRight: "1px solid #333", background: "#1e1e1e" }}>
                   <div style={{ padding: "8px", background: "#252526", color: "#ccc", fontSize: "12px", borderBottom: "1px solid #333" }}>INPUT</div>
                   <textarea value={input} onChange={(e) => setInput(e.target.value)} style={{ flex: 1, background: "#1e1e1e", color: "#d4d4d4", border: "none", padding: "12px", fontFamily: "monospace", resize: "none", outline: "none" }} />
                </div>
                <div style={{ flex: 1, display: "flex", flexDirection: "column" }}>
                    <ConsolePanel isOpen={true} onClose={() => setConsoleOpen(false)} logs={logs} onClear={() => setLogs([])} style={{ height: "100%", borderTop: "none" }} />
                </div>
             </div>
          )}
        </div>
      </div>

      <AIButton onClick={() => setAiOpen(true)} />
      <AIPanel open={aiOpen} onClose={() => setAiOpen(false)} onAsk={async (p) => { return "AI Placeholder"; }} /> 
      {!consoleOpen && <button onClick={() => setConsoleOpen(true)} style={{ position: "fixed", bottom: "10px", left: "10px", zIndex: 50 }}>Show Console</button>}
      <ShareModal isOpen={shareModalOpen} onClose={() => setShareModalOpen(false)} url={shareUrl} />
      <AuthModal isOpen={authModalOpen} onClose={() => setAuthModalOpen(false)} />
    </>
  );
}

==================================================
FILE: frontend\src\config.js
==================================================
export const API_URL = import.meta.env.VITE_API_URL || "http://localhost:5000";

==================================================
FILE: frontend\src\index.css
==================================================
:root {
  font-family: Inter, system-ui, Avenir, Helvetica, Arial, sans-serif;
  line-height: 1.5;
  font-weight: 400;

  color-scheme: dark; /* Force dark mode preference */
  color: rgba(255, 255, 255, 0.87);
  background-color: #1e1e1e; /* Match your editor theme */

  font-synthesis: none;
  text-rendering: optimizeLegibility;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

/* RESET BODY - CRITICAL FIX */
body {
  margin: 0;
  padding: 0;
  /* REMOVED: display: flex; place-items: center; */
  width: 100vw;
  height: 100vh;
  overflow: hidden; /* Prevent global scrollbars */
}

/* Ensure the React Root fills the screen */
#root {
  width: 100%;
  height: 100%;
  display: flex;
  flex-direction: column;
}

/* Optional: Make scrollbars look like VS Code */
::-webkit-scrollbar {
  width: 10px;
  height: 10px;
}
::-webkit-scrollbar-track {
  background: #1e1e1e; 
}
::-webkit-scrollbar-thumb {
  background: #444; 
  border-radius: 5px;
}
::-webkit-scrollbar-thumb:hover {
  background: #555; 
}

==================================================
FILE: frontend\src\main.jsx
==================================================
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './index.css';
import { BrowserRouter, Routes, Route } from "react-router-dom";
import { AuthProvider } from "./context/AuthContext"; // <--- IMPORT THIS

ReactDOM.createRoot(document.getElementById('root')).render(
  <React.StrictMode>
    <AuthProvider> {/* <--- WRAP EVERYTHING HERE */}
      <BrowserRouter>
        <Routes>
          <Route path="/" element={<App />} />
          <Route path="/share/:id" element={<App />} />
        </Routes>
      </BrowserRouter>
    </AuthProvider>
  </React.StrictMode>,
);

==================================================
FILE: frontend\src\components\AIButton.jsx
==================================================
import React, { useState } from "react";

export default function AIButton({ onClick }) {
  const [isHovered, setIsHovered] = useState(false);

  return (
    <button
      onClick={onClick}
      onMouseEnter={() => setIsHovered(true)}
      onMouseLeave={() => setIsHovered(false)}
      style={{
        position: "fixed",
        right: "24px",
        bottom: "24px",
        width: "64px",  // Slightly larger for a "premium" feel
        height: "64px",
        borderRadius: "50%",
        
        // Pure White Background
        background: "#FFFFFF",
        border: "none",
        cursor: "pointer",
        
        // Refined "Floating" Shadow
        boxShadow: isHovered 
          ? "0 10px 25px rgba(0,0,0,0.15), 0 4px 10px rgba(0,0,0,0.05)" // Deeper shadow on hover
          : "0 4px 12px rgba(0,0,0,0.1)", // Soft shadow normally
          
        transform: isHovered ? "translateY(-2px) scale(1.05)" : "translateY(0) scale(1)",
        transition: "all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1)", // smooth animation
        
        display: "flex",
        alignItems: "center",
        justifyContent: "center",
        zIndex: 9999,
      }}
    >
      {/* SVG Container */}
      <svg
        xmlns="http://www.w3.org/2000/svg"
        viewBox="0 0 24 24"
        width="36"   /* INCREASED SIZE: This makes the icon pop */
        height="36"
        style={{
             // Optional: Rotates the star slightly on hover
             transition: "transform 0.5s ease",
             transform: isHovered ? "rotate(90deg)" : "rotate(0deg)"
        }}
      >
        {/* Definition of the Official Gemini Gradient */}
        <defs>
          <linearGradient id="geminiGradient" x1="0%" y1="0%" x2="100%" y2="100%">
            <stop offset="0%" style={{ stopColor: "#4E79FF", stopOpacity: 1 }} />  {/* Blue */}
            <stop offset="50%" style={{ stopColor: "#9859FF", stopOpacity: 1 }} />  {/* Purple */}
            <stop offset="100%" style={{ stopColor: "#F37F5F", stopOpacity: 1 }} /> {/* Peach/Orange */}
          </linearGradient>
        </defs>
        
        {/* The Star Path - Filled with the Gradient */}
        <path 
          fill="url(#geminiGradient)" 
          d="M19 15l-1.25-2.75L15 11l2.75-1.25L19 7l1.25 2.75L23 11l-2.75 1.25zM10 2l2.5 5.5L18 10l-5.5 2.5L10 18l-2.5-5.5L2 10l5.5-2.5z" 
        />
      </svg>
    </button>
  );
}

==================================================
FILE: frontend\src\components\AIPanel.jsx
==================================================
import { useState } from "react";
import ReactMarkdown from "react-markdown";
import { Prism as SyntaxHighlighter } from "react-syntax-highlighter";
import { vscDarkPlus } from "react-syntax-highlighter/dist/esm/styles/prism";

export default function AIPanel({ open, onClose, onAsk }) {
  const [prompt, setPrompt] = useState("");
  const [loading, setLoading] = useState(false);
  const [response, setResponse] = useState("");

  async function handleAsk() {
    if (!prompt.trim()) return;
    setLoading(true);
    setResponse(""); // Clear previous response
    
    const result = await onAsk(prompt);
    
    setResponse(result);
    setLoading(false);
  }

  // Custom renderer for Code Blocks to add Copy Button & Highlighting
  const CodeBlock = ({ node, inline, className, children, ...props }) => {
    const match = /language-(\w+)/.exec(className || "");
    const codeString = String(children).replace(/\n$/, "");

    if (!inline && match) {
      return (
        <div style={{ position: "relative", margin: "10px 0", borderRadius: "8px", overflow: "hidden" }}>
          {/* Header with Copy Button */}
          <div style={{ 
            display: "flex", 
            justifyContent: "space-between", 
            alignItems: "center", 
            padding: "6px 12px", 
            background: "#2d2d2d", 
            color: "#ccc", 
            fontSize: "12px",
            borderBottom: "1px solid #444"
          }}>
            <span>{match[1].toUpperCase()}</span>
            <button 
              onClick={() => navigator.clipboard.writeText(codeString)}
              style={{ background: "transparent", border: "none", color: "white", cursor: "pointer", fontSize: "12px" }}
            >
              üìã Copy
            </button>
          </div>
          
          {/* The Syntax Highlighter */}
          <SyntaxHighlighter
            style={vscDarkPlus}
            language={match[1]}
            PreTag="div"
            customStyle={{ margin: 0, padding: "12px", fontSize: "13px" }}
            {...props}
          >
            {codeString}
          </SyntaxHighlighter>
        </div>
      );
    }

    return (
      <code className={className} style={{ background: "#e0e0e0", padding: "2px 4px", borderRadius: "4px", color: "#d63384" }} {...props}>
        {children}
      </code>
    );
  };

  if (!open) return null;

  return (
    <div
      style={{
        position: "fixed",
        bottom: "100px",
        right: "24px",
        width: "450px", // Widen slightly for code blocks
        maxHeight: "600px",
        backgroundColor: "#ffffff",
        borderRadius: "16px",
        boxShadow: "0 12px 32px rgba(0, 0, 0, 0.12)",
        padding: "20px",
        zIndex: 1000,
        fontFamily: "'Google Sans', Roboto, sans-serif",
        border: "1px solid #e0e0e0",
        display: "flex",
        flexDirection: "column",
        gap: "16px",
      }}
    >
      {/* HEADER */}
      <div style={{ display: "flex", alignItems: "center", justifyContent: "space-between" }}>
        <div style={{ display: "flex", alignItems: "center", gap: "8px" }}>
          {/* Gemini Gradient Icon */}
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
            <path d="M16 9C16.5 6.5 19 4 19 4C19 4 16.5 1.5 16 -1C15.5 1.5 13 4 13 4C13 4 15.5 6.5 16 9Z" fill="url(#grad1)" />
            <path d="M8 22C9.5 15.5 15 11 15 11C15 11 9.5 6.5 8 0C6.5 6.5 1 11 1 11C1 11 6.5 15.5 8 22Z" fill="url(#grad1)" />
            <defs>
              <linearGradient id="grad1" x1="0" y1="0" x2="24" y2="24" gradientUnits="userSpaceOnUse">
                <stop stopColor="#4E79FF" />
                <stop offset="0.5" stopColor="#9859FF" />
                <stop offset="1" stopColor="#FF5D5D" />
              </linearGradient>
            </defs>
          </svg>
          <span style={{ fontSize: "18px", fontWeight: "500", color: "#1f1f1f" }}>Gemini</span>
        </div>
        <button
          onClick={onClose}
          style={{ background: "transparent", border: "none", cursor: "pointer", color: "#5f6368", fontSize: "20px" }}
        >
          ‚úï
        </button>
      </div>

      {/* RESULT AREA */}
      {(response || loading) && (
        <div
          style={{
            flex: 1,
            minHeight: "100px",
            maxHeight: "350px",
            overflowY: "auto",
            backgroundColor: "#f8f9fa",
            borderRadius: "8px",
            padding: "16px",
            fontSize: "14px",
            lineHeight: "1.6",
            color: "#3c4043",
            border: "1px solid #f1f3f4",
          }}
        >
          {loading ? (
            <div style={{ display: "flex", alignItems: "center", gap: "8px", color: "#4E79FF" }}>
              <span>‚ú® Thinking...</span>
            </div>
          ) : (
            <ReactMarkdown components={{ code: CodeBlock }}>
              {response}
            </ReactMarkdown>
          )}
        </div>
      )}

      {/* INPUT AREA */}
      <textarea
        placeholder="Ask AI to help with your code..."
        value={prompt}
        onChange={(e) => setPrompt(e.target.value)}
        onKeyDown={(e) => {
             if(e.key === 'Enter' && !e.shiftKey) {
                 e.preventDefault();
                 handleAsk();
             }
        }}
        style={{
          width: "100%",
          height: "80px",
          backgroundColor: "#f0f4f9",
          border: "none",
          borderRadius: "12px",
          padding: "14px",
          fontSize: "14px",
          color: "#1f1f1f",
          resize: "none",
          outline: "none",
          boxSizing: "border-box",
          fontFamily: "inherit",
        }}
      />

      {/* ACTION BUTTON */}
      <button
        onClick={handleAsk}
        disabled={loading || !prompt.trim()}
        style={{
          width: "100%",
          padding: "12px 0",
          borderRadius: "20px",
          border: "none",
          background: loading || !prompt.trim() 
            ? "#e0e0e0" 
            : "linear-gradient(90deg, #4E79FF, #9859FF)",
          color: loading || !prompt.trim() ? "#9aa0a6" : "white",
          fontSize: "14px",
          fontWeight: "600",
          cursor: loading || !prompt.trim() ? "default" : "pointer",
          transition: "all 0.2s",
          boxShadow: loading ? "none" : "0 1px 2px rgba(0,0,0,0.1)",
        }}
      >
        {loading ? "Generating..." : "Ask Gemini"}
      </button>
    </div>
  );
}

==================================================
FILE: frontend\src\components\AIToolbar.jsx
==================================================
export default function AIToolbar({ onAI }) {
  return (
    <div style={bar}>
      <button onClick={() => onAI("explain")}>Explain</button>
      <button onClick={() => onAI("fix")}>Fix</button>
      <button onClick={() => onAI("optimize")}>Optimize</button>
      <button onClick={() => onAI("generate")}>Generate</button>
    </div>
  );
}

const bar = {
  background: "#111827",
  padding: "8px",
  display: "flex",
  gap: "10px",
};


==================================================
FILE: frontend\src\components\AuthModal.jsx
==================================================
import React, { useState } from "react";
import { API_URL } from "../config";
import { useAuth } from "../context/AuthContext";

export default function AuthModal({ isOpen, onClose }) {
  const { login } = useAuth();
  const [isLogin, setIsLogin] = useState(true); // Toggle between Login/Signup
  const [formData, setFormData] = useState({ username: "", email: "", password: "" });
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  if (!isOpen) return null;

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");
    setLoading(true);

    const endpoint = isLogin ? "/api/auth/login" : "/api/auth/register";
    
    try {
      const res = await fetch(`${API_URL}${endpoint}`, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(formData),
      });
      const data = await res.json();

      if (!res.ok) throw new Error(data.error || "Something went wrong");

      if (isLogin) {
        // Success! Log the user in
        login(data.user, data.token);
        onClose(); // Close modal
      } else {
        // Registration success -> Switch to login view
        setIsLogin(true);
        setError("Account created! Please log in.");
      }
    } catch (err) {
      setError(err.message);
    } finally {
      setLoading(false);
    }
  };

  return (
    <div style={overlayStyle} onClick={onClose}>
      <div style={modalStyle} onClick={(e) => e.stopPropagation()}>
        <h2 style={{ color: "#fff", marginTop: 0 }}>{isLogin ? "Welcome Back" : "Join CodePlay"}</h2>
        
        {error && <div style={{ color: "#ff6b6b", marginBottom: "10px", fontSize: "14px" }}>{error}</div>}

        <form onSubmit={handleSubmit} style={{ display: "flex", flexDirection: "column", gap: "12px" }}>
          {!isLogin && (
            <input 
              type="text" placeholder="Username" required
              value={formData.username}
              onChange={e => setFormData({...formData, username: e.target.value})}
              style={inputStyle}
            />
          )}
          <input 
            type="email" placeholder="Email" required
            value={formData.email}
            onChange={e => setFormData({...formData, email: e.target.value})}
            style={inputStyle}
          />
          <input 
            type="password" placeholder="Password" required
            value={formData.password}
            onChange={e => setFormData({...formData, password: e.target.value})}
            style={inputStyle}
          />
          
          <button type="submit" disabled={loading} style={buttonStyle}>
            {loading ? "Please wait..." : (isLogin ? "Log In" : "Sign Up")}
          </button>
        </form>

        <p style={{ color: "#888", fontSize: "13px", marginTop: "15px", textAlign: "center" }}>
          {isLogin ? "New here? " : "Already have an account? "}
          <span 
            onClick={() => { setIsLogin(!isLogin); setError(""); }}
            style={{ color: "#007acc", cursor: "pointer", fontWeight: "bold" }}
          >
            {isLogin ? "Create Account" : "Log In"}
          </span>
        </p>
      </div>
    </div>
  );
}

// Styles
const overlayStyle = { position: "fixed", top: 0, left: 0, right: 0, bottom: 0, background: "rgba(0,0,0,0.7)", display: "flex", justifyContent: "center", alignItems: "center", zIndex: 1000 };
const modalStyle = { background: "#1e1e1e", padding: "30px", borderRadius: "10px", width: "320px", border: "1px solid #333", boxShadow: "0 10px 25px rgba(0,0,0,0.5)" };
const inputStyle = { padding: "10px", borderRadius: "5px", border: "1px solid #444", background: "#252526", color: "#fff", outline: "none" };
const buttonStyle = { padding: "10px", background: "#007acc", color: "white", border: "none", borderRadius: "5px", cursor: "pointer", fontWeight: "bold" };

==================================================
FILE: frontend\src\components\CodeEditor.jsx
==================================================
import Editor, { useMonaco } from "@monaco-editor/react";
import { useEffect, useRef } from "react";

export default function CodeEditor({ value, onChange, language }) {
  const monaco = useMonaco();
  const editorRef = useRef(null);
  let debounceTimer = null;

  function handleMount(editor) {
    editorRef.current = editor;
  }

  useEffect(() => {
    if (!monaco) return;

    monaco.languages.registerInlineCompletionsProvider(language, {
      provideInlineCompletions: async (model, position) => {
        const textUntilCursor = model.getValueInRange({
          startLineNumber: Math.max(1, position.lineNumber - 20),
          startColumn: 1,
          endLineNumber: position.lineNumber,
          endColumn: position.column,
        });

        const res = await fetch("http://localhost:5000/api/ai/complete", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({
            code: textUntilCursor,
            language,
          }),
        });

        const data = await res.json();

        return {
          items: [
            {
              insertText: data.completion,
              range: {
                startLineNumber: position.lineNumber,
                startColumn: position.column,
                endLineNumber: position.lineNumber,
                endColumn: position.column,
              },
            },
          ],
        };
      },
    });
  }, [monaco, language]);

  return (
  <Editor
    height="100%"
    width="100%" // Force width
    value={value}
    onChange={onChange}
    language={language}
    onMount={handleMount}
    theme="vs-dark"
    options={{
      inlineSuggest: true,
      quickSuggestions: false,
      minimap: { enabled: false }, // Disabling minimap saves space on small screens
      scrollBeyondLastLine: false,
      automaticLayout: true, // IMPORTANT: Tells Monaco to resize automatically
    }}
  />
);
}


==================================================
FILE: frontend\src\components\ConsolePanel.jsx
==================================================
import React, { useRef, useEffect } from "react";

// Added 'style' prop here
export default function ConsolePanel({ logs, isOpen, onClose, onClear, style }) {
  const endRef = useRef(null);

  useEffect(() => {
    endRef.current?.scrollIntoView({ behavior: "smooth" });
  }, [logs, isOpen]); // Added isOpen to scroll when opened

  if (!isOpen) return null;

  return (
    <div
      style={{
        position: "relative",
        height: "200px", // Default height (overridden by style prop)
        flexShrink: 0,
        backgroundColor: "#1e1e1e",
        borderTop: "1px solid #333",
        display: "flex",
        flexDirection: "column",
        fontFamily: "'Fira Code', monospace",
        zIndex: 10,
        ...style // <--- ALLOWS OVERRIDES
      }}
    >
      {/* HEADER */}
      <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", padding: "6px 12px", backgroundColor: "#252526", borderBottom: "1px solid #333" }}>
        <div style={{ display: "flex", gap: "8px", alignItems: "center" }}>
          <span style={{ fontSize: "12px", color: "white", fontWeight: "bold" }}>OUTPUT</span>
        </div>
        <div style={{ display: "flex", gap: "10px" }}>
          <button onClick={onClear} title="Clear" style={{ background: "transparent", border: "none", color: "#ccc", cursor: "pointer" }}>üö´</button>
          <button onClick={onClose} title="Close" style={{ background: "transparent", border: "none", color: "#ccc", cursor: "pointer" }}>‚úï</button>
        </div>
      </div>

      {/* LOGS */}
      <div style={{ flex: 1, overflowY: "auto", padding: "10px", color: "#d4d4d4", fontSize: "13px" }}>
        {logs.length === 0 ?
          <div style={{ color: "#555", fontStyle: "italic" }}>No output...</div> : 
          logs.map((log, i) => (
            <div key={i} style={{ borderBottom: "1px solid #2a2a2a", padding: "4px 0", color: log.type === "error" ? "#f87171" : "#d4d4d4", display: "flex" }}>
              <span style={{ color: "#569cd6", marginRight: "8px" }}>‚Ä∫</span>
              <span style={{ whiteSpace: "pre-wrap" }}>{log.message}</span>
            </div>
          ))
        }
        <div ref={endRef} />
      </div>
    </div>
  );
}

==================================================
FILE: frontend\src\components\Editors.jsx
==================================================
import React, { useEffect, useRef, useCallback } from "react";
import Editor from "@monaco-editor/react";

export default function Editors({ 
  language, 
  html, setHtml, css, setCss, js, setJs, 
  cppCode, setCppCode, javaCode, setJavaCode, pythonCode, setPythonCode,
  socket, roomId, username, remoteCursors 
}) {

  const editorRefs = useRef({}); 
  const decorationsRef = useRef({}); 
  
  // üîí FIX: Store props in a Ref so event listeners always see the LATEST data
  const propsRef = useRef({ socket, roomId, username });

  // Update Ref whenever props change
  useEffect(() => {
    propsRef.current = { socket, roomId, username };
  }, [socket, roomId, username]);

  // --- 1. HANDLE LOCAL CURSOR MOVEMENT ---
  const handleEditorDidMount = useCallback((editor, fileType) => {
    editorRefs.current[fileType] = editor;
    
    // Initialize decorations array
    if (!decorationsRef.current[fileType]) {
        decorationsRef.current[fileType] = [];
    }

    editor.onDidChangeCursorPosition((e) => {
      // üîì READ FROM REF (Solves the "null username" bug)
      const { socket, roomId, username } = propsRef.current;

      // Check Reason: 3=Explicit Move (User typed/clicked)
      // This prevents the "Jumping Cursor" bug when code updates via socket
      const allowedReasons = [3, 4, 5]; // 3: Mouse/Keyboard, 4: Paste, 5: Undo

      if (
          socket && roomId && username && 
          allowedReasons.includes(e.reason) // Only emit if HUMAN moved it
      ) {
        const position = {
          fileType: fileType,
          lineNumber: e.position.lineNumber,
          column: e.position.column
        };
        socket.emit("cursor_move", { roomId, username, position });
      }
    });
  }, []); // Empty dependency array because we use propsRef!

  // --- 2. RENDER REMOTE CURSORS ---
  useEffect(() => {
    Object.keys(editorRefs.current).forEach((fileType) => {
      const editor = editorRefs.current[fileType];
      if (!editor) return;

      const relevantCursors = Object.entries(remoteCursors)
        .filter(([remoteUser, data]) => {
            // Show cursor if it matches file AND is not me
            return data.position.fileType === fileType && remoteUser !== username;
        });

      const newDecorationsData = relevantCursors.map(([user, data]) => {
        return {
          range: new window.monaco.Range(
            data.position.lineNumber, data.position.column,
            data.position.lineNumber, data.position.column
          ),
          options: {
            className: `cursor-${user}`, 
            hoverMessage: { value: `${user}` },
            stickiness: 1 // NeverGrowsWhenTypingAtEdges
          }
        };
      });

      const previousIds = decorationsRef.current[fileType] || [];
      const newIds = editor.deltaDecorations(previousIds, newDecorationsData);
      decorationsRef.current[fileType] = newIds;
    });
  }, [remoteCursors, username]); 

  // --- 3. CSS GENERATOR ---
  const generateCursorStyles = () => {
    let styles = "";
    Object.keys(remoteCursors).forEach((user) => {
        if (user === username) return;
        const color = getUserColor(user);
        styles += `
            .cursor-${user} { border-left: 2px solid ${color}; position: absolute; z-index: 100; }
            .cursor-${user}::after {
              content: "${user}"; position: absolute; top: -18px; left: 0;
              background-color: ${color}; color: white; font-size: 10px;
              padding: 2px 4px; border-radius: 4px; pointer-events: none; 
              opacity: 0.9; z-index: 101;
            }
        `;
    });
    return styles;
  };

  const getUserColor = (name) => {
    let hash = 0;
    for (let i = 0; i < name.length; i++) hash = name.charCodeAt(i) + ((hash << 5) - hash);
    const h = Math.abs(hash) % 360;
    return `hsl(${h}, 70%, 50%)`;
  };

  return (
    <div style={{ display: "flex", height: "100%", width: "100%" }}>
      <style>{generateCursorStyles()}</style>
      
      {/* C++ EDITOR */}
      {language !== "web" && (
        <div style={{ flex: 1, display: "flex", flexDirection: "column" }}>
          <div style={headerStyle}>{language === "cpp" ? "C++" : language === "java" ? "Java" : "Python"}</div>
          <Editor 
            height="100%" 
            language={language === "cpp" ? "cpp" : language === "java" ? "java" : "python"} 
            theme="vs-dark"
            value={language === "cpp" ? cppCode : language === "java" ? javaCode : pythonCode} 
            onChange={(val) => {
              // Call the parent setter
              if (language === "cpp") setCppCode(val);
              if (language === "java") setJavaCode(val);
              if (language === "python") setPythonCode(val);
            }}
            onMount={(editor) => handleEditorDidMount(editor, language)}
            options={editorOptions}
          />
        </div>
      )}
      
      {/* WEB EDITORS (HTML/CSS/JS) - similar logic */}
      {language === "web" && (
        <>
         <div style={paneStyle}>
            <div style={headerStyle}>HTML</div>
            <Editor height="100%" defaultLanguage="html" theme="vs-dark" value={html} onChange={setHtml} onMount={(e) => handleEditorDidMount(e, "html")} options={editorOptions} />
         </div>
         <div style={paneStyle}>
            <div style={headerStyle}>CSS</div>
            <Editor height="100%" defaultLanguage="css" theme="vs-dark" value={css} onChange={setCss} onMount={(e) => handleEditorDidMount(e, "css")} options={editorOptions} />
         </div>
         <div style={paneStyle}>
            <div style={headerStyle}>JS</div>
            <Editor height="100%" defaultLanguage="javascript" theme="vs-dark" value={js} onChange={setJs} onMount={(e) => handleEditorDidMount(e, "js")} options={editorOptions} />
         </div>
        </>
      )}
    </div>
  );
}

const paneStyle = { flex: 1, borderRight: "1px solid #333", display: "flex", flexDirection: "column" };
const headerStyle = { background: "#1e1e1e", color: "#888", padding: "8px 16px", fontSize: "12px", fontWeight: "bold", borderBottom: "1px solid #333", textTransform: "uppercase" };
const editorOptions = { minimap: { enabled: false }, fontSize: 14, wordWrap: "on", automaticLayout: true };

==================================================
FILE: frontend\src\components\Preview.jsx
==================================================
import React from "react";

export default function Preview({ html, css, js }) {
  // We inject this script to capture console.log inside the iframe
  const consoleScript = `
    <script>
      (function() {
        const customConsole = {
          log: function(...args) {
            // Convert objects to strings so they show up nicely
            const msg = args.map(arg => 
              typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ');
            
            // Send to parent window (React App)
            window.parent.postMessage({ type: 'CONSOLE_LOG', message: msg }, '*');
            
            // Also print to real browser console
            console.warn("[Internal]", ...args); 
          },
          error: function(...args) {
            const msg = args.map(arg => String(arg)).join(' ');
            window.parent.postMessage({ type: 'CONSOLE_ERROR', message: msg }, '*');
          }
        };
        
        // Override global console
        window.console.log = customConsole.log;
        window.console.error = customConsole.error;

        // Catch syntax errors
        window.onerror = function(msg, url, line) {
           window.parent.postMessage({ type: 'CONSOLE_ERROR', message: msg + " (Line " + line + ")" }, '*');
        };
      })();
    </script>
  `;

  const srcDoc = `
    <!DOCTYPE html>
    <html>
      <head>
        <style>body { margin: 0; padding: 0; }</style>
        <style>${css}</style>
        ${consoleScript} 
      </head>
      <body>
        ${html}
        <script>
          try {
            ${js}
          } catch (err) {
            console.error(err);
          }
        </script>
      </body>
    </html>
  `;

return (
    // CHANGED: "flex: 1" -> "height: '100%'"
    // This guarantees the preview fills the area above the console.
    <div style={{ height: "100%", borderTop: "1px solid #333", background: "white" }}>
      <iframe
        title="preview"
        srcDoc={srcDoc}
        sandbox="allow-scripts allow-modals"
        style={{ width: "100%", height: "100%", border: "none" }}
      />
    </div>
  );
}

==================================================
FILE: frontend\src\components\ShareModal.jsx
==================================================
import React, { useState, useEffect } from "react";

export default function ShareModal({ isOpen, onClose, url }) {
  const [copied, setCopied] = useState(false);

  // Reset "Copied" state when modal opens/closes
  useEffect(() => {
    if (isOpen) setCopied(false);
  }, [isOpen]);

  if (!isOpen) return null;

  const handleCopy = () => {
    navigator.clipboard.writeText(url);
    setCopied(true);
    setTimeout(() => setCopied(false), 2000); // Reset text after 2 seconds
  };

  return (
    <div style={overlayStyle} onClick={onClose}>
      {/* Stop click propagation so clicking inside doesn't close modal */}
      <div style={modalStyle} onClick={(e) => e.stopPropagation()}>
        
        {/* Header */}
        <div style={{ display: "flex", justifyContent: "space-between", alignItems: "center", marginBottom: "16px" }}>
          <h3 style={{ margin: 0, color: "#fff" }}>üöÄ Share Your Code</h3>
          <button onClick={onClose} style={closeButtonStyle}>‚úï</button>
        </div>

        <p style={{ color: "#ccc", fontSize: "14px", marginBottom: "12px" }}>
          Anyone with this link can view your code:
        </p>

        {/* Link Input & Copy Button */}
        <div style={{ display: "flex", gap: "10px" }}>
          <input 
            type="text" 
            readOnly 
            value={url} 
            style={inputStyle}
            onClick={(e) => e.target.select()} // Auto-select text on click
          />
          <button onClick={handleCopy} style={copyButtonStyle(copied)}>
            {copied ? "‚úÖ Copied!" : "üìã Copy"}
          </button>
        </div>

      </div>
    </div>
  );
}

// --- STYLES ---
const overlayStyle = {
  position: "fixed",
  top: 0, left: 0, right: 0, bottom: 0,
  backgroundColor: "rgba(0, 0, 0, 0.7)", // Dimmed background
  display: "flex",
  alignItems: "center",
  justifyContent: "center",
  zIndex: 1000,
  backdropFilter: "blur(2px)" // Blur effect
};

const modalStyle = {
  backgroundColor: "#1e1e1e",
  padding: "24px",
  borderRadius: "12px",
  width: "400px",
  maxWidth: "90%",
  boxShadow: "0 10px 25px rgba(0,0,0,0.5)",
  border: "1px solid #333",
  fontFamily: "sans-serif"
};

const inputStyle = {
  flex: 1,
  padding: "10px",
  borderRadius: "6px",
  border: "1px solid #444",
  backgroundColor: "#252526",
  color: "#fff",
  fontFamily: "'Fira Code', monospace",
  fontSize: "13px",
  outline: "none"
};

const closeButtonStyle = {
  background: "none",
  border: "none",
  color: "#888",
  fontSize: "18px",
  cursor: "pointer",
  padding: "4px"
};

const copyButtonStyle = (copied) => ({
  padding: "0 16px",
  borderRadius: "6px",
  border: "none",
  backgroundColor: copied ? "#238636" : "#007acc", // Green if copied, Blue otherwise
  color: "white",
  fontWeight: "bold",
  cursor: "pointer",
  transition: "background 0.2s"
});

==================================================
FILE: frontend\src\context\AuthContext.jsx
==================================================
import { createContext, useState, useEffect, useContext } from "react";

const AuthContext = createContext();

export const AuthProvider = ({ children }) => {
  const [user, setUser] = useState(null);

  // Check if user is already logged in (on page refresh)
  useEffect(() => {
    const storedUser = localStorage.getItem("codeplay_user");
    if (storedUser) {
      setUser(JSON.parse(storedUser));
    }
  }, []);

  // Login Function
  const login = (userData, token) => {
    // Save to State
    setUser(userData);
    // Save to LocalStorage (so it persists on refresh)
    localStorage.setItem("codeplay_user", JSON.stringify(userData));
    localStorage.setItem("codeplay_token", token);
  };

  // Logout Function
  const logout = () => {
    setUser(null);
    localStorage.removeItem("codeplay_user");
    localStorage.removeItem("codeplay_token");
  };

  return (
    <AuthContext.Provider value={{ user, login, logout }}>
      {children}
    </AuthContext.Provider>
  );
};

export const useAuth = () => useContext(AuthContext);
